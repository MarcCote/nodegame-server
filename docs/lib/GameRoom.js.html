<!DOCTYPE html>
<html>
<head>
  <title>GameRoom.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "lib/GameRoom.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#game%20room">Game Room</a>
      </div>
      <div class="heading h2">
        <a href="#global%20scope">Global scope</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.gamename">GameRoom.gameName</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.treatmentname">GameRoom.treatmentName</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.game">GameRoom.game</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.gamepaths">GameRoom.gamePaths</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.gametreatment">GameRoom.gameTreatment</a>
      </div>
      <div class="heading h2">
        <a href="#gameroom%20static%20functions">GameRoom static functions</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.checkparams">GameRoom.checkParams</a>
      </div>
      <div class="heading h2">
        <a href="#gameroom%20methods">GameRoom methods</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.sendremotecommand">GameRoom.sendRemoteCommand</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.setupgame">GameRoom.setupGame</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.startgame">GameRoom.startGame</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.pausegame">GameRoom.pauseGame</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.resumegame">GameRoom.resumeGame</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.stopgame">GameRoom.stopGame</a>
      </div>
      <div class="heading h3">
        <a href="#gameroom.getclienttype">GameRoom.getClientType</a>
      </div>
      <div class="heading h2">
        <a href="#setuplogic">setupLogic</a>
      </div>
      <div class="heading h2">
        <a href="#setupclients">setupClients</a>
      </div>
      <div class="heading h2">
        <a href="#gameroom.setupclient">GameRoom.setupClient</a>
      </div>
      <div class="heading h2">
        <a href="#trytogetclient">tryToGetClient</a>
      </div>
      <div class="heading h2">
        <a href="#mixingamemetadata">mixinGameMetadata</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="game%20room">
  <h1>
    <a href="#game%20room" name="game%20room" class="pilcrow">&#182;</a>
    Game Room
  </h1>
</div>


<p>Copyright(c) 2015 Stefano Balietti
MIT Licensed</p>
  </div>
  <div class="body"><p>Game room representation</p>

<p><a href='http://www.nodegame.org'>http://www.nodegame.org</a></p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>TODO: check which methods put in the prototype.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="global%20scope">
  <h2>
    <a href="#global%20scope" name="global%20scope" class="pilcrow">&#182;</a>
    Global scope
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">ngc</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;nodegame-client&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JSUS&#39;</span><span class="p">).</span><span class="nx">JSUS</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Room</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Room&#39;</span><span class="p">);</span>

<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">Room</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">GameRoom</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Room</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;Game&#39;</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">logicPath</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">logicPath</span>  <span class="o">=</span> <span class="s1">&#39;./rooms/game.room&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">gameName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom: config.gameName must be string.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">treatmentName</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">treatmentName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom: config.treatmentName must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined or string.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">runtimeConf</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">runtimeConf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom: config.channel must be object.&#39;</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.gamename">
  <h3>
    <a href="#gameroom.gamename" name="gameroom.gamename" class="pilcrow">&#182;</a>
    GameRoom.gameName
  </h3>
</div>

  </div>
  <div class="body"><p>The name of the game played in this room</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">gameName</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">gameName</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.treatmentname">
  <h3>
    <a href="#gameroom.treatmentname" name="gameroom.treatmentname" class="pilcrow">&#182;</a>
    GameRoom.treatmentName
  </h3>
</div>

  </div>
  <div class="body"><p>The name of the game played in this room, or 'standard' if not defined.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">treatmentName</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">treatmentName</span> <span class="o">||</span> <span class="s1">&#39;standard&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.game">
  <h3>
    <a href="#gameroom.game" name="gameroom.game" class="pilcrow">&#182;</a>
    GameRoom.game
  </h3>
</div>

  </div>
  <div class="body"><p>Reference to the game info object contained in servernode</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">servernode</span><span class="p">.</span><span class="nx">getGamesInfo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">gameName</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameRoom: game not found: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">gameName</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">settings</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">treatmentName</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameRoom: game &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">gameName</span> <span class="o">+</span> <span class="s1">&#39; treatment &#39;</span> <span class="o">+</span>
                        <span class="s1">&#39;not found: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">treatmentName</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.gamepaths">
  <h3>
    <a href="#gameroom.gamepaths" name="gameroom.gamepaths" class="pilcrow">&#182;</a>
    GameRoom.gamePaths
  </h3>
</div>

  </div>
  <div class="body"><p>Game paths for the room</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">clientTypes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">clientTypes</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.gametreatment">
  <h3>
    <a href="#gameroom.gametreatment" name="gameroom.gametreatment" class="pilcrow">&#182;</a>
    GameRoom.gameTreatment
  </h3>
</div>

  </div>
  <div class="body"><p>Actual settings for current game based on treatment and runtime conf</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.runtimeConf</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.setupGame
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">this</span><span class="p">.</span><span class="nx">gameTreatment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">settings</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">treatmentName</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">runtimeConf</span><span class="p">)</span> <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">gameTreatment</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">runtimeConf</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">registerRoom</span><span class="p">();</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gameroom%20static%20functions">
  <h2>
    <a href="#gameroom%20static%20functions" name="gameroom%20static%20functions" class="pilcrow">&#182;</a>
    GameRoom static functions
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.checkparams">
  <h3>
    <a href="#gameroom.checkparams" name="gameroom.checkparams" class="pilcrow">&#182;</a>
    GameRoom.checkParams
  </h3>
</div>

  </div>
  <div class="body"><p>Type-check the parameters given to setup/start/pause/resume/stopGame</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>If TRUE, sends a command to the logic as well</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>List of client IDs to which to send the
  command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>If TRUE, skip the check</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">null</span>
      <span class="dox_type">string</span>
      <span>NULL for valid parameters, error string for bad ones.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;boolean&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">doLogic</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;doLogic must be boolean or undefined&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">clientList</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">clientList</span> <span class="o">||</span>
         <span class="p">(</span><span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;all&#39;</span> <span class="o">&amp;&amp;</span>
          <span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;players&#39;</span> <span class="o">&amp;&amp;</span>
          <span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;admins&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
        <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="s2">&quot;clientList must be array, &#39;all&#39;, &#39;players&#39;, &#39;admins&#39; &quot;</span> <span class="o">+</span>
            <span class="s1">&#39;or undefined&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;boolean&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;force must be boolean or undefined&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gameroom%20methods">
  <h2>
    <a href="#gameroom%20methods" name="gameroom%20methods" class="pilcrow">&#182;</a>
    GameRoom methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.sendremotecommand">
  <h3>
    <a href="#gameroom.sendremotecommand" name="gameroom.sendremotecommand" class="pilcrow">&#182;</a>
    GameRoom.sendRemoteCommand
  </h3>
</div>

  </div>
  <div class="body"><p>Utility method for sending a remote command to given recipients</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">command</span>
      <span class="dox_type">string</span>
      <span>The command to send</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>List of client IDs to which to send the
  command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins)</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sendRemoteCommand</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>TODO: Don't send to logic!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">clientList</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">remoteCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">clientList</span> <span class="o">===</span> <span class="s1">&#39;all&#39;</span> <span class="o">||</span> <span class="nx">clientList</span> <span class="o">===</span> <span class="s1">&#39;players&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">remoteCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">clientList</span> <span class="o">===</span> <span class="s1">&#39;all&#39;</span> <span class="o">||</span> <span class="nx">clientList</span> <span class="o">===</span> <span class="s1">&#39;admins&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">admin</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">node</span><span class="p">.</span><span class="nx">remoteCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.setupgame">
  <h3>
    <a href="#gameroom.setupgame" name="gameroom.setupgame" class="pilcrow">&#182;</a>
    GameRoom.setupGame
  </h3>
</div>

  </div>
  <div class="body"><p>Setups logic and clients in the room</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixinConf</span>
      <span class="dox_type">object</span>
      <span>Optional. Additional options to pass to the node
  instance of the room. Overrides the returned game configuration from the
  require statement.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, sets up the logic as well.
  Default: TRUE.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>Optional. List of client IDs to set up,
  or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).
  Default: 'players'.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, skip the check. Default: FALSE.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.runtimeConf
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setupGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mixinConf</span><span class="p">,</span> <span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Check parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rc</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.setupGame: &#39;</span> <span class="o">+</span> <span class="nx">rc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">mixinConf</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.setupGame: mixinConf must be object or &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">clientList</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">clientList</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;all&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;players&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="nx">clientList</span> <span class="o">!==</span> <span class="s1">&#39;admins&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;GameRoom.setupGame: clientList must be &quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;undefined, array, or one of &#39;all&#39;, &#39;players&#39; &quot;</span> <span class="o">+</span>
                            <span class="s2">&quot; or &#39;admins&#39;&quot;</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Apply defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span>    <span class="nx">doLogic</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="nx">clientList</span> <span class="o">=</span> <span class="s1">&#39;players&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span>      <span class="nx">force</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Set up logic.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doLogic</span><span class="p">)</span> <span class="nx">setupLogic</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>At this point clientList should be an array of client IDs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">setupClients</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.startgame">
  <h3>
    <a href="#gameroom.startgame" name="gameroom.startgame" class="pilcrow">&#182;</a>
    GameRoom.startGame
  </h3>
</div>

  </div>
  <div class="body"><p>Starts the game for the logic and/or other clients</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, sends a start command to the
  logic as well. Default: TRUE.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>Optional. List of client IDs to which to
  send the start command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).
  Default: 'all'.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, skip the startable check.
  Default: FALSE.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Check parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rc</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.startGame: &#39;</span> <span class="o">+</span> <span class="nx">rc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Apply defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span>    <span class="nx">doLogic</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="nx">clientList</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span>      <span class="nx">force</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Check startability.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isStartable</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
            <span class="s1">&#39;GameRoom.startGame: game cannot be started.&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Start.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doLogic</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sendRemoteCommand</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.pausegame">
  <h3>
    <a href="#gameroom.pausegame" name="gameroom.pausegame" class="pilcrow">&#182;</a>
    GameRoom.pauseGame
  </h3>
</div>

  </div>
  <div class="body"><p>Pauses the game for the logic and/or other clients</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, sends a pause command to the
  logic as well. Default: TRUE.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>Optional. List of client IDs to which to
  send the pause command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).
  Default: 'all'.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, skip the pauseable check.
  Default: FALSE.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pauseGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Check parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rc</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.pauseGame: &#39;</span> <span class="o">+</span> <span class="nx">rc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Apply defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span>    <span class="nx">doLogic</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="nx">clientList</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span>      <span class="nx">force</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Check pausability.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isPausable</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
            <span class="s1">&#39;GameRoom.pauseGame: game cannot be paused.&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Pause.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doLogic</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sendRemoteCommand</span><span class="p">(</span><span class="s1">&#39;pause&#39;</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.resumegame">
  <h3>
    <a href="#gameroom.resumegame" name="gameroom.resumegame" class="pilcrow">&#182;</a>
    GameRoom.resumeGame
  </h3>
</div>

  </div>
  <div class="body"><p>Resumes the game for the logic and/or other clients</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, sends a resume command to the
  logic as well. Default: TRUE.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>Optional. List of client IDs to which to
  send the resume command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).
  Default: 'all'.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, skip the resumeable check.
  Default: FALSE.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resumeGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Check parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rc</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.resumeGame: &#39;</span> <span class="o">+</span> <span class="nx">rc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>Apply defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span>    <span class="nx">doLogic</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="nx">clientList</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span>      <span class="nx">force</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Check resumability.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isResumable</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
            <span class="s1">&#39;GameRoom.resumeGame: game cannot be resumed.&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Resume.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doLogic</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sendRemoteCommand</span><span class="p">(</span><span class="s1">&#39;resume&#39;</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.stopgame">
  <h3>
    <a href="#gameroom.stopgame" name="gameroom.stopgame" class="pilcrow">&#182;</a>
    GameRoom.stopGame
  </h3>
</div>

  </div>
  <div class="body"><p>Stops the game for the logic and/or other clients</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">doLogic</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, sends a stop command to the logic
  as well. Default: TRUE.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">array</span>
      <span class="dox_type">string</span>
      <span>Optional. List of client IDs to which to
  send the stop command, or one of the following strings:
  'all' (all clients), 'players' (all players), 'admins' (all admins).
  Default: 'all'.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, skip the stopable check.
  Default: FALSE.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stopGame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>Check parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">GameRoom</span><span class="p">.</span><span class="nx">checkParams</span><span class="p">(</span><span class="nx">doLogic</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">,</span> <span class="nx">force</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rc</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameRoom.stopGame: &#39;</span> <span class="o">+</span> <span class="nx">rc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Apply defaults.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">doLogic</span><span class="p">)</span>    <span class="nx">doLogic</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="nx">clientList</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">force</span><span class="p">)</span>      <span class="nx">force</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Check stoppability.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isStoppable</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
            <span class="s1">&#39;GameRoom.stopGame: game cannot be stopped.&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Stop.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doLogic</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sendRemoteCommand</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="nx">clientList</span><span class="p">);</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.getclienttype">
  <h3>
    <a href="#gameroom.getclienttype" name="gameroom.getclienttype" class="pilcrow">&#182;</a>
    GameRoom.getClientType
  </h3>
</div>

  </div>
  <div class="body"><p>Loads a specified client type</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">type</span>
      <span class="dox_type">string</span>
      <span>The name of the client type</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>The getd client type</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getClientType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">stager</span><span class="p">,</span> <span class="nx">setup</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">clientTypes</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameRoom.getClientType: unknown type: &#39;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mixinConf</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameRoom.getClientType: runtimeConf must &#39;</span> <span class="o">+</span>
                        <span class="s1">&#39;be object.&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">stager</span> <span class="o">=</span> <span class="nx">ngc</span><span class="p">.</span><span class="nx">getStager</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">stager</span><span class="p">.</span><span class="nx">getState</span><span class="p">());</span>
    <span class="nx">setup</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">setup</span><span class="p">);</span>
    <span class="nx">settings</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">gameTreatment</span><span class="p">);</span>
    <span class="nx">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clientTypes</span><span class="p">[</span><span class="nx">type</span><span class="p">](</span><span class="k">this</span><span class="p">.</span><span class="nx">treatmentName</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">stager</span><span class="p">,</span>
                                  <span class="nx">setup</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">game</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameRoom.getClientType: room &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span>
                        <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; did not return a valid game object.&#39;</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Add treatment settings.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">game</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>Mixin-in nodeGame options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">game</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">game</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>Helper functions.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="setuplogic">
  <h2>
    <a href="#setuplogic" name="setuplogic" class="pilcrow">&#182;</a>
    setupLogic
  </h2>
</div>

  </div>
  <div class="body"><p>Instantiates and setups the logic of the game room</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixinConf</span>
      <span class="dox_type">object</span>
      <span>Optional. Additional options to mixin with the
  instantiated client type.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.getClientType</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.node
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">setupLogic</span><span class="p">(</span><span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">game</span><span class="p">,</span> <span class="nx">node</span><span class="p">;</span>

    <span class="nx">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getClientType</span><span class="p">(</span><span class="s1">&#39;logic&#39;</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">);</span>

    <span class="nx">mixinGameMetadata</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">game</span><span class="p">);</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>Stop logic if necessary.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isStoppable</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Setup must be called before connect.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">node</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="s1">&#39;nodegame&#39;</span><span class="p">,</span> <span class="nx">game</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Connect logic to server, if not already connected. E.g., after a stop
command it is generally still connected. Or the node object can be
passed in the constructor and be already connected.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">isConnected</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">setSocketType</span><span class="p">(</span><span class="s1">&#39;SocketDirect&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">socket</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">adminServer</span><span class="p">.</span><span class="nx">socketManager</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">direct</span>
        <span class="p">});</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">startingRoom</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">clientType</span><span class="o">:</span>   <span class="s1">&#39;logic&#39;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="setupclients">
  <h2>
    <a href="#setupclients" name="setupclients" class="pilcrow">&#182;</a>
    setupClients
  </h2>
</div>

  </div>
  <div class="body"><p>Instantiates and setups a number of clients of the game room</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientList</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>The list of clients or a string
 specifying which clients are to be setup (Accepted values:
 'all', 'players', or 'admins')</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixinConf
</span>
      <span class="dox_type">object</span>
      <span>Optional. Additional options to mixin with the instantiated client
 type.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.getClientType</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.node
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">setupClients</span><span class="p">(</span><span class="nx">clientList</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">cache</span><span class="p">;</span>

    <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>Resolve special values of clientList.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">clientList</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">clientList</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;all&#39;</span><span class="o">:</span>
            <span class="nx">clientList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getAllKeys</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;players&#39;</span><span class="o">:</span>
            <span class="nx">clientList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getAllKeys</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;admins&#39;</span><span class="o">:</span>
            <span class="nx">clientList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">admin</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getAllKeys</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>Setup all given clients.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">clientList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setupClient</span><span class="p">(</span><span class="nx">clientList</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">mixinConf</span><span class="p">,</span> <span class="nx">cache</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gameroom.setupclient">
  <h2>
    <a href="#gameroom.setupclient" name="gameroom.setupclient" class="pilcrow">&#182;</a>
    GameRoom.setupClient
  </h2>
</div>

  </div>
  <div class="body"><p>Setups a client based on its id</p>

<p>Retrieves the client object, checks its client type, and run the
appropriate setup command depending if the client it is a bot or
a remote client.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientId</span>
      <span class="dox_type">string</span>
      <span>The id of the client</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixinConf</span>
      <span class="dox_type">object</span>
      <span>Optional. Additional configuration options</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cache</span>
      <span class="dox_type">object</span>
      <span>Optional. A cache object from where retrieving
  client types</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">boolean</span>
      <span>TRUE on success</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.getClientType
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">GameRoom</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setupClient</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">clientId</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">,</span> <span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">clientObj</span><span class="p">,</span> <span class="nx">gameNode</span><span class="p">,</span> <span class="nx">type</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">game</span><span class="p">;</span>

    <span class="nx">clientObj</span> <span class="o">=</span> <span class="nx">tryToGetClient</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">clientObj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;GameRoom.setupClient: client not found: &#39;</span> <span class="o">+</span>
                                   <span class="nx">clientId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>Fake cache.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">cache</span> <span class="o">=</span> <span class="nx">cache</span> <span class="o">||</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>See if the client is local or remote.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">gameNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">bots</span><span class="p">[</span><span class="nx">clientId</span><span class="p">];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>Client type.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">type</span> <span class="o">=</span> <span class="nx">clientObj</span><span class="p">.</span><span class="nx">clientType</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>Get the client type, check cache (bots are never cached).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gameNode</span> <span class="o">&amp;&amp;</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
        <span class="nx">game</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getClientType</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">mixinConf</span><span class="p">);</span>
        <span class="nx">mixinGameMetadata</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">game</span><span class="p">);</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">game</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>Setup the client.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>Local client.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">gameNode</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>Can't remoteSetup here because serializing the plot methods
would make them lose their context (node etc.).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">gameNode</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
        <span class="nx">gameNode</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="s1">&#39;nodegame&#39;</span><span class="p">,</span> <span class="nx">game</span><span class="p">);</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>Remote client.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">remoteCommand</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">remoteSetup</span><span class="p">(</span><span class="s1">&#39;nodegame&#39;</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">game</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="trytogetclient">
  <h2>
    <a href="#trytogetclient" name="trytogetclient" class="pilcrow">&#182;</a>
    tryToGetClient
  </h2>
</div>

  </div>
  <div class="body"><p>Returns a client obj with given id, if found.</p>

<p>Notice: separated from the main function because of the try-catch block,
otherwise the whole function is not optimized.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">clientId</span>
      <span class="dox_type">string</span>
      <span>The client id</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>The client object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">tryToGetClient</span><span class="p">(</span><span class="nx">clientId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">clientObj</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">clientObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">clients</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">clientId</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">sysLogger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;GameRoom.setupGame: no client with id &#39;&quot;</span> <span class="o">+</span>
                                   <span class="nx">clientId</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">clientObj</span><span class="p">;</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="mixingamemetadata">
  <h2>
    <a href="#mixingamemetadata" name="mixingamemetadata" class="pilcrow">&#182;</a>
    mixinGameMetadata
  </h2>
</div>

  </div>
  <div class="body"><p>Adds default game info (name, description, version) if missing</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">game</span>
      <span class="dox_type">object</span>
      <span>The game object used to setup a client</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.setupClients</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameRoom.setupLogic
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">mixinGameMetadata</span><span class="p">(</span><span class="nx">game</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">)</span> <span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">description</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">version</span><span class="p">)</span> <span class="nx">game</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">version</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
